<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Vulnerability Report</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-gray-50 text-gray-800">
  <div class="max-w-4xl mx-auto py-10 px-4">
    <h1 class="text-3xl font-bold mb-6">üîç Vulnerability Report</h1>
    <div id="summary" class="mb-6"></div>
    <div id="files"></div>
  </div>

  <script>
    const PROJECT_ID = "00000000-0000-0000-0000-000000000001";
    const API_URL = `http://localhost:8000/report/${PROJECT_ID}`;

    axios.get(API_URL)
      .then(response => {
        const data = response.data;
        const summary = document.getElementById('summary');
        const filesContainer = document.getElementById('files');

        // Summary
        summary.innerHTML = `
          <div class="bg-white border border-gray-200 shadow rounded p-4">
            <p><strong>Project ID:</strong> ${data.project_id}</p>
            <p><strong>Total Files Scanned:</strong> ${data.summary.total_files_scanned}</p>
            <p><strong>Total Vulnerabilities:</strong> ${data.summary.total_vulnerabilities}</p>
            <div class="mt-2">
              <strong>Vulnerability Counts:</strong>
              <ul class="list-disc ml-5 mt-1">
                ${Object.entries(data.summary.vulnerability_counts).map(([type, count]) => 
                  `<li>${type}: ${count}</li>`).join('')}
              </ul>
            </div>
          </div>
        `;

        // Files + vulnerabilities
        data.files.forEach(file => {
          const card = document.createElement('div');
          card.className = "bg-white shadow border border-gray-100 rounded-lg mt-6";
          card.innerHTML = `
            <div class="p-4 border-b border-gray-200 bg-gray-50">
              <h2 class="text-xl font-semibold">${file.file_name}</h2>
              <p class="text-sm text-gray-600">Type: ${file.file_type} ‚Ä¢ LOC: ${file.loc}</p>
              <a href="${file.file_url}" target="_blank" class="text-blue-500 text-sm underline">View File</a>
            </div>
            <div class="p-4 space-y-4">
              ${file.vulnerabilities.map(vuln => `
                <div class="bg-red-50 border border-red-300 rounded-md p-3">
                  <p class="font-medium text-red-700">${vuln.type}</p>
                  <p class="text-sm">${vuln.description}</p>
                  <p class="text-xs text-gray-500">Lines: ${vuln.line_from}‚Äì${vuln.line_to}</p>
                  <p class="text-xs text-gray-400">Detected on: ${new Date(vuln.created_at).toLocaleString()}</p>
                  <p class="text-xs text-green-700 mt-1"><strong>Fix Suggestion:</strong> ${vuln.suggestion || "No suggestion available."}</p>
                </div>
              `).join('')}
            </div>
          `;
          filesContainer.appendChild(card);
        });
      })
      .catch(err => {
        document.body.innerHTML = `<div class="text-red-600 text-center mt-10">‚ùå Error fetching report: ${err.message}</div>`;
      });
  </script>
</body>
</html>
